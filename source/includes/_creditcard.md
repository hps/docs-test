# Credit Card Payments
Follow these steps to take credit card payments using your language of choice. 

## Create a Customer
The first step is to create a Customer for which you want to charge.

```csharp
var cardHolder = new HpsCardHolder()
{
	Address = new HpsAddress() { Zip = "47130" }    // Zip is required, but pass over as much as you have
};
```

```php
<?php
$cardHolder =  new HpsCardHolder();
$address = new HpsAddress();
$address->zip = "47130"
$cardHolder->address = $address;
?>
```

```java
HpsCardHolder cardHolder = new HpsCardHolder();
cardHolder.getAddress().setZip("47130");
```

```ruby
card_holder = Hps::HpsCardHolder.new
card_holder.address.zip = "75024"
```

```python
card_holder = HpsCardHolder()
card_holder.address.zip = '75024'
```

```javascript
var cardHolder = {
    address: { zip: "47130" }    // Zip is the only required address field.
};
```

## Charge a Credit Card Token

The credit sale transaction authorizes a sale purchased with a credit card. The authorization is placed in the current open batch (should auto-close for e-commerce transactions). If a batch is not open, this transaction will create an open batch.

```csharp
creditService.Charge(10.00m, "usd", "Put single or multi-use token here", cardHolder);
```

```php
<?php
$chargeService->charge(10, "usd", "put single or multi-use token here", $cardHolder);
?>
```

```java
chargeService.charge(new BigDecimal("10"), "usd", "put single or multi-use token here", cardHolder);
```

```ruby
charge_service.charge(10, "usd", "put single or multi-use token here", card_holder)
```

```python
response = credit_service.charge(10, 'usd', "put single or multi-use token here", card_holder)
```

```javascript
creditService.chargeWithCard(10, "usd", "put single or multi-use token here", cardHolder, false, null, function (err, response) {
  if (err) {
    // handle error
    return;
  }
  // Do something with response
});
```

###Parameters:

Parameter | Description
--------- | -----------
Amount | The amount (in dollars)
Currency | The currency (3-letter ISO code for currency).
Card | A single-use token, multi-use token or an HpsCreditCard object
CardHolder (optional) |  The card holder information (used for AVS).
Request Multi Use Token (optional) | Request a multi-use token.
Memo (optional) | Free-form field (for Merchant reporting/record-keeping purposes only).

###Returns: HpsAuthorization

Parameter | Description
--------- | -----------
Authorization Code| If authorized, authorization code returned by the Issuer
Avs Result Code | If address verification requested, address verification result code returned by the Issuer
Avs Result Text | Description of AVS result code
Cvv Result Code | If card verification was provided in the request, card verification result code provided by the Issuer
Cvv Result Text | Description of CVV result code
Cpc Indicator | If the commercial card was specified in the request, the commercial card response indicator returned by the Issuer
Authorized Amount | If supplied from the Issuer on a partial authorization, the authorized amount (less than the original or requested amount).
Card Type | Card brand name
Descriptor | Generated by concatenating the TxnDescriptor string from the transaction request to a configurable merchant DBA name. This string is sent to the card issuer for the Merchant Name.
Token Data | Token Rsp Code, Token Rsp Message, Token Value

## Verify a Credit Card Token

A credit account verify transaction is used to verify that the account is in good standing with the issuer. This is a zero dollar transaction with no associated authorization. Since VISA and other issuers have started assessing penalties for one dollar authorizations, this provides a way for merchants to accomplish the same task while avoiding these penalties.

```csharp
creditService.Verify("put single or multi-use token here", cardHolder);
```

```php
<?php
$chargeService->verify("put single or multi-use token here", $cardHolder);
?>
```

```java
service.verify("put single or multi-use token here", cardHolder);
```

```ruby
charge_service.verify("put single or multi-use token here", card_holder)
```

```python
response = credit_service.verify("put single or multi-use token here", card_holder)
```

```javascript
creditService.verifyWithCard("put single or multi-use token here", cardHolder, function (err, response) {
  if (err) {
    // handle error
    return;
  }
  // Do something with response
});
```

###Parameters:

Parameter | Description
--------- | -----------
Card | The credit card information.
CardHolder (optional) | The card holder information (used for AVS).

###Returns: HpsAuthorization

Parameter | Description
--------- | -----------
Authorization Code| If authorized, authorization code returned by the Issuer
Avs Result Code | If address verification requested, address verification result code returned by the Issuer
Avs Result Text | Description of AVS result code
Cvv Result Code | If card verification was provided in the request, card verification result code provided by the Issuer
Cvv Result Text | Description of CVV result code
Cpc Indicator | If the commercial card was specified in the request, the commercial card response indicator returned by the Issuer
Authorized Amount | If supplied from the Issuer on a partial authorization, the authorized amount (less than the original or requested amount).
Card Type | Card brand name
Descriptor | Generated by concatenating the TxnDescriptor string from the transaction request to a configurable merchant DBA name. This string is sent to the card issuer for the Merchant Name.
Token Data | Token Rsp Code, Token Rsp Message, Token Value

## Authorize a Credit Card Token

A credit authorization transaction authorizes a credit card transaction. The authorization is NOT placed in the batch. The credit authorization transaction can be committed by using the capture method.

```csharp
creditService.Authorize(10.00m, "usd", "put single or multi-use token here", cardHolder);
```

```php
<?php
$chargeService->authorize(10, "usd", "put single or multi-use token here", $cardHolder);
?>
```

```java
chargeService.authorize(new BigDecimal("10"), "usd", "put single or multi-use token here", cardHolder);
```

```ruby
charge_service.authorize(50.00, "usd", "put single or multi-use token here", card_holder)
```

```python
response = credit_service.authorize(10, 'usd', "put single or multi-use token here", card_holder)
```

```javascript
creditService.authorizeWithCard(10, "usd", "put single or multi-use token here", cardHolder, false, null, function (err, response) {
  if (err) {
    // handle error
    return;
  }
  // Do something with response
});
```

###Parameters:

Parameter | Description
--------- | -----------
Amount | The amount (in dollars)
Currency | The currency (3-letter ISO code for currency).
Card | A single-use token, multi-use token or an HpsCreditCard object
CardHolder (optional) | The card holder information (used for AVS).
Request Multi Use Token (optional) | Request a multi-use token.
Memo (optional) | Free-form field (for Merchant reporting/record-keeping purposes only).

###Returns: HpsAuthorization

Parameter | Description
--------- | -----------
Authorization Code| If authorized, authorization code returned by the Issuer
Avs Result Code | If address verification requested, address verification result code returned by the Issuer
Avs Result Text | Description of AVS result code
Cvv Result Code | If card verification was provided in the request, card verification result code provided by the Issuer
Cvv Result Text | Description of CVV result code
Cpc Indicator | If the commercial card was specified in the request, the commercial card response indicator returned by the Issuer
Authorized Amount | If supplied from the Issuer on a partial authorization, the authorized amount (less than the original or requested amount).
Card Type | Card brand name
Descriptor | Generated by concatenating the TxnDescriptor string from the transaction request to a configurable merchant DBA name. This string is sent to the card issuer for the Merchant Name.
Token Data | Token Rsp Code, Token Rsp Message, Token Value




## Using Multi-Use Tokens

Multi-Use Tokenization allows a secure and PCI friendly way to store credit card information within your system. A multi-use token can be generated as part of any of our initial gateway calls: charge, verify or authorize.

<aside class="notice">
Multi-Use tokens are not enabled by default. You must contact your Heartland Representitive to request this functionality on your account.
</aside>

> Requesting a multi-use token

```csharp
// Request Token with Charge
var chargeResponse = creditService.Charge(10, "usd", creditCard, cardHolder, true);
var chargeToken = chargeResponse.TokenData.TokenValue;

// Request Token with Authorize
var authResponse = creditService.Authorize(10, "usd", creditCard, cardHolder, true);
var authToken = authResponse.TokenData.TokenValue;
```

```php
<?php
// Request Token with Charge
$response = $chargeService->charge(10, "usd", $validCard, null, true);
$token = $response->tokenData->tokenValue;

// Request Token with Authorize
$response = $chargeService->authorize(10, "usd", $validCard, null, true);
$token = $response->tokenData->tokenValue;
?>
```

```java
/** Request Token with Charge */
HpsCharge chargeResponse = chargeService.charge(new BigDecimal("10"), "usd", creditCard, cardHolder, true, null);
String chargeToken = chargeResponse.getTokenData().getTokenValue();

/** Request Token with Authorize */
HpsAuthorization authResponse = chargeService.authorize(new BigDecimal("10"), "usd", creditCard, cardHolder, true, null);
String authToken = authResponse.getTokenData().getTokenValue();
```

```ruby
charge_response = charge_service.charge(10, "usd", credit_card, card_holder, true)
charge_token = charge_response.token_data.token_value

auth_response = charge_service.authorize(10, "usd", credit_card, card_holder, true)
auth_token = auth_response.token_data.token_value
```

```python
# Request Token with Charge
charge_response = credit_service.charge(10, 'usd', credit_card, card_holder, True)
charge_token = charge_response.token_data.token_value

# Request Token with Authorize
auth_response = credit_service.authorize(10, 'usd', credit_card, card_holder, True)
auth_token = auth_response.token_data.token_value
```

> Charging a multi-use token

```csharp
creditService.Charge(10, "usd", chargeToken, cardHolder);
```

```php
<?php
$muToken = new HpsTokenData();
$muToken->tokenValue = $tokenValue;
$response = $chargeService->charge(10, "usd", $muToken, $cardHolder);
?>
```

```java
chargeService.charge(new BigDecimal("10"), "usd", chargeToken, cardHolder);
```

```ruby
charge_service.charge(10, "usd", charge_token, card_holder)
```

```python
response = credit_service.charge(10, 'usd', charge_token, card_holder)
```

> Authorizing a multi-use token

```csharp
creditService.authorize(10.00m, "usd", chargeToken, cardHolder);
```

```php
<?php
$muToken = new HpsTokenData();
$muToken->tokenValue = $tokenValue;
$response = $chargeService->authorize(10, "usd", $muToken, $cardHolder);
?>
```

```java
chargeService.authorize(new BigDecimal("10"), "usd", authToken, cardHolder);
```

```ruby
charge_service.authorize(10, "usd", auth_token, card_holder)
```

```python
response = credit_service.authorize(10, 'usd', auth_token, card_holder)
```

## Capture an Authorization

A Capture transaction adds a previous authorization transaction to the current open batch. If a batch is not open, this transaction will create one. 

```csharp
var authResponse = creditService.Authorize(10.00m, "usd", "put single or multi-use token here", cardHolder); // create auth
creditService.Capture(authResponse.TransactionId); // capture auth
```

```php
<?php
$response = $chargeService->authorize(10, "usd", "put single or multi-use token here", $cardHolder); // create auth
$captureResponse = $chargeService->capture($response->transactionId); // capture auth
?>
```

```java
var authResponse = chargeService.authorize(new BigDecimal("10"), "usd", "put single or multi-use token here", cardHolder); // create auth
chargeService.capture(authResponse.getTransactionID()); // capture auth
```

```ruby
response = charge_service.authorize(10, "usd", "put single or multi-use token here", card_holder)
capture_response = charge_service.capture(response.transaction_id);
```

```python
auth_response = credit_service.authorize(10, 'usd', "put single or multi-use token here", card_holder)
capture_response = credit_service.capture(auth_response.transaction_id)
```

```javascript
var response;

creditService.authorizeWithCard(10, "usd", "put single or multi-use token here", cardHolder, false, null, function (err, resp) {
  if (err) return;
  response = resp;
});

creditService.capture(response.transactionId, 10, function (err, resp) {
  // Do something with the response
});
```

###Parameters:

Parameter | Description
--------- | -----------
Transaction Id | The authorization transaction Id.
Amount (optional) | An amount to charge (optional). Used if different from original authorization.

###Returns: HpsReportTransactionDetails (of HpsAuthorization)

Parameter | Description
--------- | -----------
HpsAuthorization | Returns the above HpsAuthorization data
Original Transaction Id | If the transaction performed an action on a previous transaction, this field records the transaction that was acted upon.
Masked Card Number | Card number (masked)
Settlement Amount | Settlement amount
Transaction Type | The transaction type (i.e. Authorize, Capture, Charge, Refund, etc...)
Transaction Utc Date | Date of the transaction in universal time.
Exceptions | Any exceptions which may have occured during the transaction.
Memo | a free-form field (for Merchant reporting/record-keeping purposes only).
Invoice Number | This will not be used at settlement. (for Merchant reporting/record-keeping purposes only).
Customer Id | free-form field for Merchant use. This is intended to be the customer identification. (for Merchant reporting/record-keeping purposes only).

## Refund a Transaction

The credit return transaction returns funds to the cardholder. The transaction is generally used as a counterpart to a credit card transaction that needs to be reversed, and the batch containing the original transaction has already been closed. The credit return transaction is placed in the current open batch. If a batch is not open, this transaction will create an open batch.

```csharp
var chargeResponse = creditService.Charge(10.00m, "usd", "put single or multi-use token here", cardHolder);
creditService.Refund(10.00m, "usd", chargeResponse.TransactionId);
```

```php
<?php
$response = $chargeService->charge(10, "usd", "put single or multi-use token here", $cardHolder);
$chargeService->refundTransaction(10, "usd", $response->transactionId);
?>
```

```java
var chargeResponse = chargeService.Charge(new BigDecimal("10"), "usd", "put single or multi-use token here", cardHolder);
chargeService.refund(new BigDecimal("10"), "usd", chargeResponse.getTransactionID());
```

```ruby
charge_response = charge_service.charge(10, "usd", "put single or multi-use token here", card_holder)
charge_service.refund(10, "usd", charge_response.transaction_id)
```

```python
charge_response = credit_service.charge(10, 'usd', "put single or multi-use token here", card_holder)
refund_response = credit_service.refund(10, 'usd', charge_response.transaction_id)
```

```javascript
var response;

creditService.chargeWithCard(10, "usd", "put single or multi-use token here", cardHolder, false, null, function (err, resp) {
  if (err) return;
  response = resp;
});

creditService.refundWithTransactionId(10, 'usd', response.transactionId, null, null, function (err, resp) {
  // Do something with the response
});
```

###Parameters:

Parameter | Description
--------- | -----------
Amount| The amount (in specified currency)
Currency | The currency (3-letter ISO code for currency).
Transaction Id | The Id of the Transaction to be refunded.
CardHolder (optional) | The card holder information (used for AVS).
Memo (optional) | Free-form field (for Merchant reporting/record-keeping purposes only).

###Returns: HpsRefund

## Reverse a Transaction

A reverse transaction reverses a Charge or Authorize transaction from the active open authorizations or current open batch.

```csharp
var authResponse = creditService.Authorize(10.00m, "usd", "put single or multi-use token here", cardHolder);
creditService.Reverse(authResponse.TransactionId, 10.00m, "usd");
```

```php
<?php
$response = $chargeService->authorize(10, "usd", "put single or multi-use token here", $cardHolder);
$chargeService->reverseTransaction($response->transactionId, 10, "usd");
?>
```

```java
var authResponse = chargeService.authorize(new BigDecimal("10"), "usd", "put single or multi-use token here", cardHolder);
chargeService.reverse(authResponse.transactionId, BigDecimal("10"), "usd");
```

```ruby
response = charge_service.authorize(10, "usd", "put single or multi-use token here", card_holder)
charge_service.reverse(response.transactionId, 10, "usd");
```

```python
auth_response = credit_service.authorize(10, 'usd', "put single or multi-use token here", card_holder)
reverse_response = credit_service.reverse(auth_response.transaction_id, 10, 'usd')
```

```javascript
var response;

creditService.chargeWithCard(10, "usd", "put single or multi-use token here", cardHolder, false, null, function (err, resp) {
  if (err) return;
  response = resp;
});

creditService.reverseWithTransactionId(10, 'usd', response.transactionId, null, function (err, resp) {
  // Do something with the response
});
```

###Parameters:

Parameter | Description
--------- | -----------
Transaction ID | The transaction ID of charge to reverse.
Amount | The amount (in specified currency).
Currency | The currency (3-letter ISO code for currency).
Memo (optional) | Free-form field (for Merchant reporting/record-keeping purposes only).

###Returns: HpsReversal

## Void a Transaction

A credit void transaction is used to inactivate a transaction. The transaction must be an Authorize, Charge or Return. The transaction must be active in order to be voided. Authorize transactions do not have to be associated with a batch to be voided. Transactions may be voided after they are associated with a batch as long as the batch is not closed.

<aside class="note">If the batch containing the original transaction has been closed, a Return transaction may be used to credit the cardholder.</aside>

<aside class="note">If a transaction has been returned, it cannot be voided.</aside>

```csharp
var authResponse = creditService.Authorize(10.00m, "usd", "put single or multi-use token here", cardHolder);
creditService.Void(authResponse.TransactionId);
```

```php
<?php
$response = $chargeService->authorize(10, "usd", "put single or multi-use token here", $cardHolder);
$chargeService->void($response->transactionId);
?>
```

```java
var authResponse = chargeService.authorize(new BigDecimal("10"), "usd", "put single or multi-use token here", cardHolder);
chargeService.void(authResponse.transactionId);
```

```ruby
response = charge_service.authorize(10, "usd", "put single or multi-use token here", card_holder)
charge_service.void(response.transactionId);
```

```python
auth_response = credit_service.authorize(10, 'usd', "put single or multi-use token here", card_holder)
void_response = credit_service.void(auth_response.transaction_id)
```

###Parameters:

Parameter | Description
--------- | -----------
Transaction ID | The transaction ID of charge to void.

###Returns: HpsVoid

## Edit a Transaction

An edit transaction changes the data on a previously approved Charge or Authorize transaction.

<aside class="note">When the settlement amount of a transaction is altered with this service, the Portico Gateway does not send an update to the Issuer. For example, if the settlement amount of a transaction is reduced, a reversal for the difference is not sent. Likewise, if the amount is increased, an additional authorization is not sent. These additional operations are the responsibility of the POS. Additional features like this are being considered for future releases of the Portico Gateway.</aside>

```csharp
var authResponse = creditService.Authorize(10.00m, "usd", "put a single or multi-use token here", cardHolder);
creditService.Edit(authResponse.TransactionId, 15.00m, 5.00m);
```

```php
<?php
$response = $chargeService->authorize(10, "usd", "put a single or multi-use token here", $cardHolder);
$chargeService->edit($response->transactionId, 15, 5);
?>
```

```java
var authResponse = chargeService.authorize(new BigDecimal("10"), "usd", "put a single or multi-use token here", cardHolder);
chargeService.edit(authResponse.transactionId, new BigDecimal("15"), new BigDecimal("5"));
```

```ruby
response = charge_service.authorize(10, "usd", "put a single or multi-use token here", card_holder)
charge_service.edit(response.transactionId, 15, 5);
```

```python
auth_response = credit_service.authorize(10, 'usd', "put a single or multi-use token here", card_holder)
void_response = credit_service.edit(auth_response.transaction_id, 15, 5)
```

###Parameters:

Parameter | Description
--------- | -----------
Transaction ID | The transaction ID of charge to void.
Amount | If not null, revises (replaces) the authorized amount of the original auth. If null, does not affect the authorized amount of the original auth.
Gratuity | If not null, revises (replaces) the gratuity amount information of the original auth. If null, does not affect the gratuity amount information, if any, of the original auth. This element is for informational purposes only and does not affect the authorized amount.
Client Transaction Id | The optional client transaction ID.

###Returns: HpsTransaction